# Бэклог проекта Analyzer

Этот документ отслеживает технический долг, идеи по улучшению и новые функции для проекта `analyzer`.

## Технический долг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TD-001 | Вынести `ZERO_THRESHOLD` в конфигурацию | `analyze_pair_fast` | High | To Do | Константа `ZERO_THRESHOLD = 0.05` жестко закодирована. Она должна быть параметром командной строки или загружаться из файла конфигурации для гибкой настройки. |
| TD-002 | Улучшить обработку ошибок | `analyze_symbol_batch` | Medium | To Do | Блок `except Exception: pass` при загрузке данных скрывает потенциальные проблемы. Необходимо добавить логирование ошибок в отдельный файл. |
| TD-003 | Конфигурируемые пути вывода | `run_ultra_fast_analysis` | Medium | To Do | Директория `summary_stats` и формат имени файла `summary_stats_{timestamp}.csv` жестко закодированы. Эти параметры должны быть настраиваемыми. |
| TD-004 | Убрать "магические числа" | Весь скрипт | Medium | To Do | Числа, такие как `10` для вывода топ-пар или `3` в множителе для воркеров (`cpu_count() * 3`), должны быть вынесены в константы или параметры. |
| TD-005 | Гибкое сопоставление имен символов | `load_exchange_symbol_data` | Low | To Do | Текущий механизм угадывания формата имени символа (с `#` или без) является хрупким. Следует внедрить систему конфигурации для явного сопоставления (например, через YAML-файл). |
| TD-006 | Загрузка конфигурации из файла | `run_ultra_fast_analysis` | Low | To Do | Все параметры передаются через `argparse`. Для сложных сценариев лучше добавить поддержку файла конфигурации (например, `config.yaml`), который может быть переопределен аргументами командной строки. |

## Рефакторинг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| REF-001 | Модуляризация кода | Весь скрипт | High | To Do | Весь код находится в одном файле `run_all_ultra.py`. Необходимо разбить его на логические модули: `data_loader.py`, `analysis.py`, `reporting.py` и `main.py` для улучшения читаемости и поддержки. |
| REF-002 | Декомпозиция `analyze_pair_fast` | `analyze_pair_fast` | Medium | To Do | Функция слишком длинная и сложная. Ее следует разбить на несколько меньших, чисто функциональных и тестируемых частей: одна для синхронизации, другая для расчета отклонений, третья для циклов и т.д. |
| REF-003 | Переписать `count_complete_cycles` на чистом Polars | `analyze_pair_fast` | Medium | To Do | Функция использует `.to_numpy()`, что создает копию данных и является потенциальным узким местом. Переписывание на чистый Polars API (с использованием `window functions`) улучшит производительность и консистентность кода. |

## Тестирование

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TEST-001 | Unit-тесты для `analyze_pair_fast` | `analyze_pair_fast` | High | To Do | Написать unit-тесты для ключевых алгоритмов, особенно для `count_complete_cycles`, с использованием заранее подготовленных `DataFrame` с известными результатами. |
| TEST-002 | Integration-тест для всего пайплайна | Весь скрипт | High | To Do | Создать интеграционный тест, который запускает `run_ultra_fast_analysis` на небольшом наборе тестовых данных и проверяет корректность итогового CSV-файла. |
| TEST-003 | Тесты для `load_exchange_symbol_data` | `load_exchange_symbol_data` | Medium | To Do | Написать тесты, проверяющие корректность работы фильтрации по датам и обработки разных форматов путей. |

## Новые функции и улучшения

| ID | Фича | Компонент | Приоритет | Статус | Описание |
|----|-------|-----------|----------|--------|----------|
| FEAT-001 | Полный анализ арбитражных путей | `analyze_pair_fast` | High | To Do | Текущий анализ использует только `bid_ex1 / bid_ex2`. Необходимо расширить анализ для учета всех 4 путей (`bid1/ask2`, `ask1/bid2`) для более полного поиска возможностей. |
| FEAT-002 | Учет комиссий и проскальзывания | `analyze_pair_fast` | High | To Do | Добавить в расчеты параметры комиссий бирж и моделирование проскальзывания, чтобы метрики "возможностей" были более реалистичными. |
| FEAT-003 | Генерация HTML-отчетов с графиками | `run_ultra_fast_analysis` | Medium | To Do | Вместо простого CSV-файла генерировать интерактивный HTML-отчет, включающий графики временных рядов отклонений для топ-10 пар. |
| FEAT-004 | Дополнительные статистические тесты | `analyze_pair_fast` | Medium | To Do | Добавить расчет более продвинутых метрик, таких как тест Дики-Фуллера (ADF) для программного подтверждения стационарности ряда отклонений, или расчет коэффициента Шарпа для оценки доходности к риску. |
| FEAT-005 | Режим реального времени | Новые компоненты | Low | To Do | Разработать режим работы, который сможет подключаться к live-потокам данных с бирж и проводить анализ в реальном времени. |
| FEAT-006 | Поддержка альтернативных источников данных | `load_exchange_symbol_data` | Low | To Do | Расширить функционал для загрузки данных не только с локального диска, но и из облачных хранилищ (S3) или баз данных (ClickHouse, InfluxDB). |

## Документация

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| DOC-001 | Перевод документации на английский | `docs` | High | Done | Основные документы `architecture.md` и `process_flow.md` были переведены с русского на английский язык для соответствия стандартам проекта. |
| DOC-002 | Создание диаграммы процесса | `docs/5_mermaid` | High | Done | Была создана Mermaid-диаграмма `process_flow.mmd` для визуализации основного потока работы приложения. |
