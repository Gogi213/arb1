# Бэклог проекта Collections (SpreadAggregator)

Этот документ отслеживает технический долг, идеи по улучшению и новые функции для проекта `SpreadAggregator`.

## Технический долг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TD-007 | Исправить дублирование данных и конкурирующих потребителей | `Application`/`Presentation` | Critical | To Do | `OrchestrationService` некорректно пишет каждое сообщение дважды в один и тот же экземпляр канала. `DataCollectorService` и `RollingWindowService` являются конкурирующими потребителями этого канала, что приводит к неполной и искаженной обработке данных. Необходимо создать два отдельных канала и настроить `OrchestrationService` для записи в каждый из них по одному разу, реализуя истинный fan-out-паттерн. |
| TD-001 | Улучшить обработку ошибок в клиентах бирж | `Infrastructure` | High | To Do | Текущая обработка ошибок в клиентах бирж может быть недостаточной. Необходимо добавить более детальное логирование и механизмы восстановления. |
| TD-002 | Мониторинг состояния каналов | `Application` | Medium | To Do | Добавить метрики и мониторинг для `System.Threading.Channels` (например, размер очереди, количество обработанных элементов) для выявления узких мест. |
| TD-003 | Конфигурирование клиентов бирж | `Infrastructure` | Medium | To Do | Параметры подключения к биржам (API ключи, URL) должны быть вынесены в централизованную конфигурацию, а не жестко закодированы. |
| TD-006 | (Устарело) Прояснить использование двух каналов | `OrchestrationService` | N/A | Obsolete | Исследование показало, что `_rawDataChannel` и `_rollingWindowChannel` являются одним и тем же экземпляром канала. Истинная проблема задокументирована в `TD-007`. |
| TD-004 | Оптимизация записи в Parquet | `ParquetDataWriter` | Low | To Do | Исследовать возможности оптимизации записи в Parquet (например, буферизация, сжатие) для больших объемов данных. |
| TD-005 | Управление жизненным циклом `RollingWindowService` | `Application` | Low | To Do | Убедиться, что `RollingWindowService` корректно инициализируется, останавливается и очищает ресурсы. |

## Рефакторинг

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| REF-001 | Разделение интерфейсов клиентов бирж | `Application` | Medium | To Do | Разделить `IExchangeClient` на более мелкие интерфейсы (например, `IDataStreamClient`, `IOrderBookClient`) для лучшего соответствия принципам SOLID. |
| REF-002 | Унификация обработки рыночных данных | `Domain` | Medium | To Do | Создать единую модель `MarketData` для всех бирж, чтобы избежать дублирования логики трансформации данных. |
| REF-003 | Переход на асинхронные методы в `SpreadCalculator` | `Domain` | Low | To Do | Если `SpreadCalculator` выполняет потенциально долгие операции, рассмотреть возможность перехода на асинхронные методы. |
| REF-004 | Рефакторинг `ProcessExchange` | `OrchestrationService` | High | To Do | Метод `ProcessExchange` в `OrchestrationService` слишком длинный и нарушает SRP. Его следует разбить на более мелкие методы, отвечающие за конфигурацию, фильтрацию и подписку. |
| REF-005 | Внедрить `ISymbolNormalizer` | `OrchestrationService` | Medium | To Do | Логика нормализации имен символов в `ProcessExchange` является неявной и жестко закодированной. Создать сервис `ISymbolNormalizer` для инкапсуляции этой логики. |

## Тестирование

| ID | Задача | Компонент | Приоритет | Статус | Описание |
|----|--------|-----------|----------|--------|----------|
| TEST-001 | Unit-тесты для `SpreadCalculator` | `Domain` | High | To Do | Написать unit-тесты для логики вычисления спредов с использованием различных сценариев рыночных данных. |
| TEST-002 | Интеграционные тесты для потока данных | `Application` | High | To Do | Создать интеграционные тесты, которые имитируют поток данных от клиентов бирж через каналы до `OrchestrationService` и `ParquetDataWriter`. |
| TEST-003 | Тесты для WebSocket-сервера | `Infrastructure` | Medium | To Do | Проверить корректность работы `WebSocketServer` при подключении/отключении клиентов и трансляции спредов. |

## Новые функции и улучшения

| ID | Фича | Компонент | Приоритет | Статус | Описание |
|----|-------|-----------|----------|--------|----------|
| FEAT-001 | Поддержка новых бирж | `Infrastructure` | High | To Do | Добавить поддержку новых криптовалютных бирж путем реализации соответствующих клиентов. |
| FEAT-002 | Расширенные алгоритмы поиска спредов | `Domain` | Medium | To Do | Внедрить более сложные алгоритмы поиска спредов (например, треугольный арбитраж, арбитраж с учетом глубины стакана). |
| FEAT-003 | Аутентификация и авторизация для WebSocket | `Infrastructure` | Medium | To Do | Добавить механизмы аутентификации и авторизации для клиентов WebSocket-сервера. |
| FEAT-004 | Хранение конфигурации в базе данных | `Infrastructure` | Low | To Do | Перенести конфигурацию (например, список отслеживаемых символов, параметры бирж) из файлов в базу данных для динамического управления. |
| FEAT-005 | Интеграция с системой оповещений | `Application` | Low | To Do | Добавить возможность отправки уведомлений (например, по email, Telegram) при обнаружении особо крупных спредов или проблем в работе. |