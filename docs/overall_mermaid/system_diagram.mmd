graph LR
    subgraph Exchanges
        E1[Exchange 1 WS]
        E2[Exchange 2 WS]
        E3[...]
    end

    subgraph "Project: collections"
        direction TB
        A["<b>collections</b><br>(C# Data Hub)"]
        A -- "1. Ingests raw data" --> P1["Processes & Calculates Spreads"]
        P1 -- "2a. Broadcasts<br>Real-time Spreads" --> WS_Out["WebSocket Server<br>(ws://localhost:8181)"]
        P1 -- "2b. Writes Raw Data<br><b>(INCOMPLETE DATA DUE TO BUG)</b>" --> D_DataLake[(Data Lake<br>Parquet Files)]
    end
    
    subgraph "Project: trader"
        B["<b>trader</b><br>(C# Bot)"]
        B -- "3. Listens for spreads" --> WS_Out
        B -- "4. Detects Opportunity" --> B_HALT["<b>PROCESS HALTS<br>(Execution is TODO)</b>"]
        style B_HALT fill:#d63031,stroke:#000,stroke-width:2px
    end

    subgraph "Project: analyzer"
        C["<b>analyzer</b><br>(Python Batch Analysis)"]
        C -- "5. Reads historical data" --> D_DataLake
        C -- "6. Generates CSV reports" --> C_Reports[(CSV Reports<br>summary_stats)]
    end
    
    subgraph "External Actors"
        U[Human Operator]
    end

    E1 & E2 & E3 --> A
    
    C_Reports -- "7. Informs strategy" --> U
    U -- "8. Configures" --> B

    classDef project fill:#ececff,stroke:#9090ff,stroke-width:2px,font-weight:bold
    class A,B,C project
