# Основной Поток Операций (Целевая Логика)

Этот документ описывает **целевой (правильный)** полный цикл операций, разделяя "источник значения" и "источник средств".

---

### Подготовка

**0. Снепшот начального баланса Gate.io**
-   **Источник значения:** Баланс `H` на **Gate.io** *до начала цикла*.
-   **Назначение:** Сохраняется в `ArbitrageCycleState` для использования в `Leg 2`.

---

### LEG 1: Gate.io -> Bybit

**1. гейт лимит бай**
-   **Источник значения (Сумма):** `gateIoConfig.Amount` из файла `appsettings.json`.
-   **Источник средств (Деньги):** Баланс `USDT` на **Gate.io**.
-   **Назначение:** Ордер на покупку `H` на **Gate.io**.
-   **Результат:** `H` зачислен на баланс **Gate.io**.

**2. снепшот баланса гейт**
-   **Источник значения:** Баланс `H` на **Gate.io** после исполнения ордера.
-   **Назначение:** Внутренняя переменная в коде для немедленной продажи.

**3. снепшот баланса гейт идёт в байбит сел маркет**
-   **Источник значения (Количество):** Внутренняя переменная с количеством `H` с шага 2.
-   **Источник средств (Актив):** Баланс `H` на **Bybit**.
-   **Назначение:** Ордер на продажу `H` на **Bybit**.
-   **Результат:** `H` списан с баланса **Bybit**, `USDT` зачислен на баланс **Bybit**.

**4. снепшот USDT от продажи**
-   **Источник значения:** **Количество USDT, полученное от продажи на шаге 3 (`cumExecValue` из ордера).**
-   **Назначение:** Переменная `leg1ResultUsdtAmount` передается в `Leg 2`.

---

### LEG 2: Bybit -> Gate.io

**5. снепшот USDT от продажи идёт в лимит бай байбит**
-   **Источник значения (Сумма):** Переменная `leg1ResultUsdtAmount` из `Leg 1`.
-   **Источник средств (Деньги):** Баланс `USDT` на **Bybit**.
-   **Назначение:** Ордер на покупку `H` на **Bybit**.
-   **Результат:** `USDT` списаны с баланса **Bybit**, `H` зачислен на баланс **Bybit**.

**6. снепшот баланса гейт идёт в маркет сел гейт**
-   **Источник значения (Количество):** **Начальный баланс `H` на Gate.io**, сохраненный на шаге 0.
-   **Источник средств (Актив):** Баланс `H` на **Gate.io**.
-   **Назначение:** Ордер на продажу `H` на **Gate.io**.
-   **Результат:** Цикл ребалансировки завершен. `H` продан на **Gate.io**.