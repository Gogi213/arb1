# PROPOSAL-2025-0022: Round Bybit Sell Quantity to Integer

## 1. Diagnostic
- **Files Affected:**
  - `trader/src/Core/ArbitrageTrader.cs`
- **Problem:** After standardizing order quantities to the base asset, market sell orders on Bybit are failing with the error: "Order quantity has too many decimals." This is because for the `H/USDT` pair, Bybit's API requires the quantity of `H` to be an integer.
- **Severity:** `critical`

## 2. Proposed Change Set

### Rationale
To comply with Bybit's API requirements for this specific pair, we must round the sell quantity down to the nearest whole number before placing the order. This ensures the order is accepted by the exchange.

### Change: Update `ArbitrageTrader.cs`
Add rounding logic for the sell quantity.

```diff
--- a/trader/src/Core/ArbitrageTrader.cs
+++ b/trader/src/Core/ArbitrageTrader.cs
@@ -85,12 +85,16 @@
  
                  // Bybit uses a different symbol format (without underscore)
                  var sellSymbol = filledOrder.Symbol.Replace("_", "");
+                 
+                 // Bybit requires integer quantity for H/USDT pair. Round down to be safe.
+                 var sellQuantity = Math.Floor(filledOrder.Quantity);
  
                  var t2 = DateTime.UtcNow;
                  var sellOrderId = await _sellExchange.PlaceOrderAsync(
                      sellSymbol,
                      OrderSide.Sell,
                      NewOrderType.Market,
-                     quantity: filledOrder.Quantity); // USE BASE ASSET QUANTITY
+                     quantity: sellQuantity);
                  var t3 = DateTime.UtcNow;
  
                  var placeOrderLatency = (t3 - t2).TotalMilliseconds;

```

## 3. Rollback Steps
- Revert the changes in `trader/src/Core/ArbitrageTrader.cs` using `git checkout`.

## 4. Risk Assessment
- **Very Low.** This is a necessary fix to comply with the exchange's API rules. Rounding down is a safe operation that prevents selling more than available.

## 5. Testing Plan
- Run `Leg 1`.
- Verify from the logs that the sell order on Bybit is now placed with an integer quantity.
- Confirm that the sell order executes successfully.