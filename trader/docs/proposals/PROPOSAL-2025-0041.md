# PROPOSAL-2025-0041: (Temporary) Hardcode BybitTrailingTrader Amount to Unblock Testing

## 1. Compact Diagnostic

Analysis of `websocket.txt` confirms that all order placement attempts in `Leg 2` are rejected by Bybit with `retCode:170131, retMsg:"Insufficient balance."`. This occurs even though the correct USDT amount is passed from `Leg 1`.

The root cause is likely a discrepancy between the calculated order quantity and the *actual available* USDT balance on the UNIFIED account at the moment of order placement.

A full fix requires a more robust balance management system. However, to unblock the testing of the final step of our main flow (`ReverseArbitrageTrader` sell logic), this proposal suggests a temporary workaround.

## 2. Proposed Change

### File: `trader/src/Exchanges/Bybit/BybitTrailingTrader.cs`

**Purpose:** Temporarily override the passed `amount` with a small, hardcoded value to ensure the `Leg 2` buy order can be placed successfully.

```diff
<<<<<<< SEARCH
:start_line:85
-------
            _bybitTrailingTrader.StartAsync(bybitSymbol, amount, dollarDepth);
=======
            // TEMPORARY WORKAROUND to bypass "Insufficient balance" issue for testing.
            var tempAmount = 1m; // Use $1 to ensure the order goes through.
            FileLogger.LogOther($"[Y3-WARN] Using temporary hardcoded amount: ${tempAmount}");
            _bybitTrailingTrader.StartAsync(bybitSymbol, tempAmount, dollarDepth);
>>>>>>> REPLACE
```
*Note: This change should be applied to `ReverseArbitrageTrader.cs` where `BybitTrailingTrader` is called.*

## 3. Rationale

This is a tactical, temporary change. Its sole purpose is to allow the `Leg 2` buy order to execute, which will then trigger the `HandleBuyOrderFilled` logic in `ReverseArbitrageTrader`. This will allow us to verify if the final step of our target flow (selling the initial Gate.io balance) works as intended.

This is not a permanent fix. A new technical debt item (TD-012) will be created to address the "Insufficient balance" issue properly.

## 4. Risk Assessment

- **Risk:** Low. This is a temporary, isolated change for testing purposes. It will be reverted.
- **Mitigation:** The change is clearly marked as a temporary workaround with logging.

## 5. Testing Plan

1.  Approve and apply the diff.
2.  Run the application.
3.  **Expected Outcome:**
    *   `Leg 1` completes as normal.
    *   `Leg 2` starts. The log will show the warning about the temporary amount.
    *   The buy order on Bybit for `$1` should now execute successfully.
    *   The logic should proceed to the `Y5 MARKET` phase in `ReverseArbitrageTrader`.
    *   The final sell order on Gate.io should be placed using the initial balance stored in `ArbitrageCycleState`.
    *   The full cycle should complete.

## 6. Rollback Steps

-   Revert the change in `trader/src/Exchanges/Bybit/ReverseArbitrageTrader.cs`.