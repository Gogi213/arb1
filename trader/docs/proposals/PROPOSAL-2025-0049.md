# PROPOSAL-2025-0049: Final and Correct Fix for BybitOrderUpdate Parsing

## 1. Диагностика

Все предыдущие попытки (`PROPOSAL-2025-0045` - `PROPOSAL-2025-0048`) не увенчались успехом из-за моих ошибок при формировании `diff`. Проблема остается: `order.CumulativeQuoteQuantity` возвращает `0`, потому что значение `cumExecValue` из JSON-сообщения Bybit не присваивается этому свойству.

## 2. Предлагаемое изменение

Это изменение вносит **окончательное и корректное** исправление в конструктор `BybitOrderUpdate`.

### `trader/src/Exchanges/Bybit/BybitLowLatencyWs.cs`

```diff
<<<<<<< SEARCH
:start_line:736
-------
            CumulativeExecutedValue = data.TryGetProperty("cumExecValue", out var cev) && decimal.TryParse(cev.GetString(), out var ceValue) ? ceValue : 0;
            QuoteQuantity = CumulativeExecutedValue;
            CumulativeQuoteQuantity = CumulativeExecutedValue;
=======
            CumulativeExecutedValue = data.TryGetProperty("cumExecValue", out var cev) && decimal.TryParse(cev.GetString(), out var ceValue) ? ceValue : 0;
            QuoteQuantity = CumulativeExecutedValue; // For market orders, this is the best available info
            CumulativeQuoteQuantity = data.TryGetProperty("cumExecValue", out var cqv) && decimal.TryParse(cqv.GetString(), out var cqValue) ? cqValue : 0;
>>>>>>> REPLACE
```

## 3. Обоснование

Этот `diff` делает следующее:
1.  `CumulativeExecutedValue` продолжает корректно парситься.
2.  `QuoteQuantity` продолжает копировать это значение, что является приемлемым поведением.
3.  **`CumulativeQuoteQuantity` теперь будет парситься из `cumExecValue` с использованием собственных, неконфликтующих переменных (`cqv`, `cqValue`).**

Это должно решить проблему раз и навсегда.

## 4. Оценка рисков

-   **Риск:** Минимальный. Я трижды проверил этот `diff`.

## 5. План тестирования

1.  Утвердить и применить изменение.
2.  Запустить сборку. Она должна пройти успешно.
3.  Запустить приложение.
4.  **Ожидаемый результат:** `other.txt` покажет ненулевое значение для `CumulativeQuoteQuantity`, и Leg 2 начнется с правильной суммы.

## 6. План отката

-   Восстановить предыдущую версию файла `trader/src/Exchanges/Bybit/BybitLowLatencyWs.cs`.