# PROPOSAL-2025-0096: –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ RollingWindow

**–î–∞—Ç–∞:** 2025-11-08
**–°—Ç–∞—Ç—É—Å:** üîµ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ

---

## 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø—Ä–æ–µ–∫—Ç–∞—Ö `collections` –∏ `charts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RollingWindow` —Å —Ä–∞–∑–º–µ—Ä–æ–º –≤ 1 —á–∞—Å. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏–∑–±—ã—Ç–æ—á–Ω–æ–º—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é –ø–∞–º—è—Ç–∏ (–æ–∫–æ–ª–æ 708 MB –Ω–∞ –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞), –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ UI –∏ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–æ—Ä–∞–∑–¥–æ –º–µ–Ω—å—à–µ–≥–æ –æ–∫–Ω–∞.

**–†–∏—Å–∫:** –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, —á—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ OOM –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

---

## 2. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

–£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä `RollingWindow` —Å 1 —á–∞—Å–∞ –¥–æ 30 –º–∏–Ω—É—Ç –≤ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 1: –ü—Ä–æ–µ–∫—Ç `collections` (C#)

**–§–∞–π–ª:** `collections/src/SpreadAggregator.Application/Services/RollingWindowService.cs`

```diff
--- a/collections/src/SpreadAggregator.Application/Services/RollingWindowService.cs
+++ b/collections/src/SpreadAggregator.Application/Services/RollingWindowService.cs
@@ -12,7 +12,7 @@
 public class RollingWindowService
 {
     private readonly ConcurrentDictionary<string, RollingWindowData> _windows = new();
-    private readonly TimeSpan _windowSize = TimeSpan.FromHours(1);
+    private readonly TimeSpan _windowSize = TimeSpan.FromMinutes(30);
     private readonly ChannelReader<MarketData> _channelReader;
     private Timer? _cleanupTimer;
 

```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ 2: –ü—Ä–æ–µ–∫—Ç `charts` (Python)

**–§–∞–π–ª:** `charts/server.py`

```diff
--- a/charts/server.py
+++ b/charts/server.py
@@ -57,7 +57,7 @@
 
 class RollingWindow:
     def __init__(self):
-        self.window_size = timedelta(hours=1)
+        self.window_size = timedelta(minutes=30)
         self.windows: Dict[str, RollingWindowData] = {}
         self.cleanup_timer: Optional[Timer] = None
 

```

---

## 3. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

- **–≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –æ–∫–Ω–∞ –≤ 2 —Ä–∞–∑–∞ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—é –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ —ç—Ç–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 50%.
- **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** 30-–º–∏–Ω—É—Ç–Ω–æ–µ –æ–∫–Ω–æ –≤—Å–µ –µ—â–µ —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–∞–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.

---

## 4. –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1.  **Code Review:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –æ–±–æ–∏—Ö —Ñ–∞–π–ª–∞—Ö.
2.  **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º):**
    - –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞.
    - –û—Ç–∫—Ä—ã—Ç—å UI (–¥–∞—à–±–æ—Ä–¥).
    - **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ì—Ä–∞—Ñ–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞—è –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç.
3.  **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º):**
    - –ó–∞–º–µ—Ä–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ `collections` –∏ `charts` –¥–æ –∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
    - **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–º–µ—Ç–∏—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.

---

## 5. –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

- –í–µ—Ä–Ω—É—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤ `RollingWindowService.cs` –∏ `server.py` –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π.
- –ò–∑–º–µ–Ω–∏—Ç—å `TimeSpan.FromMinutes(30)` –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `TimeSpan.FromHours(1)` –∏ `timedelta(minutes=30)` –Ω–∞ `timedelta(hours=1)`.