# План Спринта 5: Торговая логика на основе спреда (Редакция 2)

**Цель:** Разработать механизм для запуска арбитражного цикла только при обнаружении выгодной возможности, используя внешний поставщик данных о спредах.

---

### Архитектура Решения

Вместо реализации сложной логики мониторинга стаканов внутри проекта `trader`, будет использован существующий проект `collections` (`SpreadAggregator`) как внешний сервис-поставщик данных.

-   **`collections` (SpreadAggregator):** Выступает в роли **WebSocket-сервера**. Он подключается к биржам, агрегирует данные стаканов, вычисляет спреды и транслирует их всем подключенным клиентам.
-   **`trader` (TraderBot):** Выступает в роли **WebSocket-клиента**. Он подключается к `collections`, получает готовые данные о спредах и на их основе принимает решение о запуске цикла.

### Декомпозиция Задачи

**1. На стороне `trader` (основной проект):**

-   **Шаг 1.1: Реализовать "Слушателя спредов" (SpreadListener):**
    -   Создать простой класс, реализующий WebSocket-клиент.
    -   При запуске он должен подключаться к WebSocket-серверу, запущенному проектом `collections`.
    -   Он будет получать сообщения, десериализовать их (например, в `SpreadData`).

-   **Шаг 1.2: Реализовать "Принимающего решения" (DecisionMaker):**
    -   Этот компонент получает данные о спреде от "Слушателя".
    -   Он проверяет, соответствует ли пара торгуемой (например, "H_USDT") и превышает ли чистый спред заданный порог.
    -   Если условия выполнены, он вызывает `Orchestrator` для запуска полного арбитражного цикла.

-   **Шаг 1.3: Обновить точку входа (`Program.cs`):**
    -   Изменить логику запуска, чтобы инициализировать и запустить "Слушателя спредов" и "Принимающего решения" вместо прямого вызова `Orchestrator`.

**2. На стороне `collections` (поставщик данных):**

-   **Шаг 2.1: Запуск и конфигурация:**
    -   Убедиться, что проект `collections` сконфигурирован для отслеживания нужной торговой пары.
    -   Проект запускается как независимый фоновый процесс.

---

### Оценка Сложности

**Общая сложность: Средняя**

-   **Причины снижения сложности:** Мы полностью устраняем самую рискованную часть — управление стаканами и расчет спредов в реальном времени — и перекладываем ее на уже готовый, специализированный сервис. Задача для `trader` сводится к реализации простого WebSocket-клиента и несложной логики принятия решений.

### Ключевые риски

1.  **Сетевое взаимодействие:** Необходимо обеспечить надежное переподключение WebSocket-клиента в `trader` в случае разрыва связи с сервером `collections`.
2.  **Контракт данных:** Формат данных (`SpreadData`), передаваемый от `collections`, должен быть синхронизирован с моделью, которую ожидает `trader`.