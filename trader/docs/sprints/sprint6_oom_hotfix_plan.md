# Sprint 6: OOM Critical Hotfix Plan

**–î–∞—Ç–∞:** 2025-11-08
**–°—Ç–∞—Ç—É—Å:** –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Kilo Code

---

## 1. –¶–µ–ª—å –°–ø—Ä–∏–Ω—Ç–∞

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —ç—Ç–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞ ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—É—Ç–µ–º —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ—Ö –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö (P0) —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ —Å–±–æ—è–º `OutOfMemoryException` (OOM) –≤ production-—Å—Ä–µ–¥–µ.

–≠—Ç–æ—Ç —Å–ø—Ä–∏–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–∫—Ü–∏–µ–π –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã –∏–∑ [–∞—É–¥–∏—Ç–∞ OOM](../../audit/01_OOM_CRITICAL_FINDINGS.md).

## 2. –ó–∞–¥–∞—á–∏ –≤ –°–ø—Ä–∏–Ω—Ç–µ

| ID | –ó–∞–¥–∞—á–∞ | –ü—Ä–æ–µ–∫—Ç | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ (—á–∞—Å—ã) | –°—Ç–∞—Ç—É—Å |
|----|--------|--------|-----------|---------------|--------|
| 1  | –ó–∞–º–µ–Ω–∏—Ç—å `Channel.CreateUnbounded` –Ω–∞ `Channel.CreateBounded` | `collections` | üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (P0)** | 4 | To Do |
| 2  | –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `_allSymbolInfo` –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö | `collections` | üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (P0)** | 1 | To Do |
| 3  | –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–∏—Å—Ç–∫–∏ –¥–ª—è `MOCK_OPPORTUNITIES` | `charts` | üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (P0)** | 0.5 | To Do |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** 5.5 —á–∞—Å–æ–≤.

---

## 3. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ó–∞–¥–∞—á

### –ó–∞–¥–∞—á–∞ 1: –ó–∞–º–µ–Ω–∏—Ç—å Unbounded Channels

- **–ü—Ä–æ–±–ª–µ–º–∞:** `RawDataChannel` –∏ `RollingWindowChannel` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É —Ä–æ—Å—Ç—É –æ—á–µ—Ä–µ–¥–∏ –∏ OOM, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º.
- **–§–∞–π–ª:** `collections/src/SpreadAggregator.Presentation/Program.cs`
- **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å `Channel.CreateUnbounded<T>()` –Ω–∞ `Channel.CreateBounded<T>(new BoundedChannelOptions(100000))`. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –∏ —Å–æ–∑–¥–∞—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.

### –ó–∞–¥–∞—á–∞ 2: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `_allSymbolInfo`

- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –±–∏—Ä–∂–µ —Å–ø–∏—Å–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `_allSymbolInfo` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ª–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.
- **–§–∞–π–ª:** `collections/src/SpreadAggregator.Application/Services/OrchestrationService.cs`
- **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `_allSymbolInfo.AddRange(allSymbols)` –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `HashSet<string>` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω —Å–∏–º–≤–æ–ª–æ–≤.

### –ó–∞–¥–∞—á–∞ 3: –û—á–∏—Å—Ç–∫–∞ `MOCK_OPPORTUNITIES`

- **–ü—Ä–æ–±–ª–µ–º–∞:** –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `MOCK_OPPORTUNITIES` –≤ `charts/server.py` —Ö—Ä–∞–Ω–∏—Ç –±–æ–ª—å—à–æ–π DataFrame –≤ –ø–∞–º—è—Ç–∏ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —É—Ç–µ—á–∫–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞.
- **–§–∞–π–ª:** `charts/server.py`
- **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `shutdown` –¥–ª—è FastAPI, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —è–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å `MOCK_OPPORTUNITIES = None`, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –ø–∞–º—è—Ç—å.

---

## 4. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

- **–ó–∞–¥–∞—á–∞ 1:** –ö–∞–Ω–∞–ª—ã `RawDataChannel` –∏ `RollingWindowChannel` —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ `Bounded`. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø–æ OOM –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏–∑-–∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤.
- **–ó–∞–¥–∞—á–∞ 2:** –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å `_allSymbolInfo`, –æ—Å—Ç–∞–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –ø–æ—Å–ª–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∏—Ä–∂–∞–º.
- **–ó–∞–¥–∞—á–∞ 3:** –ü–∞–º—è—Ç—å, –∑–∞–Ω–∏–º–∞–µ–º–∞—è `MOCK_OPPORTUNITIES`, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ `charts`.

## 5. –†–∏—Å–∫–∏

- **–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è —Ç–æ—á–µ—á–Ω—ã–º–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ–≤–∏–¥–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã.