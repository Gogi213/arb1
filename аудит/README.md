# –ê–£–î–ò–¢ ARB1 PROJECT - –ü–†–û–ë–õ–ï–ú–´ OOM –ò –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 2025-11-08
**–ü—Ä–æ–≤–µ–¥–µ–Ω–æ:** Claude Code (Automated Analysis)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù

---

## –°–û–î–ï–†–ñ–ê–ù–ò–ï –ü–ê–ü–ö–ò

### üìä –ì–ª–∞–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:

1. **[–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md](./–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md)** ‚≠ê –ù–ê–ß–ù–ò–¢–ï –ó–î–ï–°–¨
   - Executive summary
   - –¢–æ–ø-5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
   - –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏
   - ROI –∞–Ω–∞–ª–∏–∑
   - **–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: 5 –º–∏–Ω—É—Ç**

2. **[OOM_–∞–Ω–∞–ª–∏–∑.md](./OOM_–∞–Ω–∞–ª–∏–∑.md)**
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é
   - 43 –ø—Ä–æ–±–ª–µ–º—ã (10 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö, 15 –≤—ã—Å–æ–∫–∏—Ö, 18 —Å—Ä–µ–¥–Ω–∏—Ö)
   - –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ events –∏ callbacks
   - –ü—Ä–æ–±–ª–µ–º—ã —Å WebSocket –∏ –±—É—Ñ–µ—Ä–∞–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø–æ—Ç–æ–∫–∞–º–∏
   - –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - **–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: 30 –º–∏–Ω—É—Ç**

3. **[–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md](./–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md)**
   - –ê–Ω–∞–ª–∏–∑ —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
   - –ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ø—Ä–æ—â–µ–Ω–∏—é
   - **–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: 45 –º–∏–Ω—É—Ç**

---

## –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –ï—Å–ª–∏ —É –≤–∞—Å 5 –º–∏–Ω—É—Ç:
üëâ –ß–∏—Ç–∞–π—Ç–µ [–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md](./–ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md)

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å OOM:
üëâ –ß–∏—Ç–∞–π—Ç–µ [OOM_–∞–Ω–∞–ª–∏–∑.md](./OOM_–∞–Ω–∞–ª–∏–∑.md) ‚Üí —Ä–∞–∑–¥–µ–ª "1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´"

### –ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:
üëâ –ß–∏—Ç–∞–π—Ç–µ [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md](./–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md) ‚Üí —Ä–∞–∑–¥–µ–ª "6. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò"

---

## –û–°–ù–û–í–ù–´–ï –ù–ê–•–û–î–ö–ò

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (10):

1. **Unbounded Channels** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OOM –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
2. **RollingWindow 1 —á–∞—Å** - 708 MB –ø–∞–º—è—Ç–∏ (–Ω—É–∂–Ω–æ 36 MB)
3. **Event handlers leak** - —É—Ç–µ—á–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö
4. **8x –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ Parquet** - 614 MB –±—É—Ñ–µ—Ä–æ–≤
5. **_allSymbolInfo —Ä–æ—Å—Ç** - –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ
6. **Async lambda leak** - OrchestrationService –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
7. **WebSocket dead connections** - –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è
8. **Fire-and-forget tasks** - –Ω–µ—Ç cleanup
9. **DataFrame –∫–æ–ø–∏–∏** - 5x —É–º–Ω–æ–∂–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
10. **Parquet –±—É—Ñ–µ—Ä—ã** - –¥–æ 19 GB –≤–æ–∑–º–æ–∂–Ω–æ

### ‚ùå –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ RollingWindow** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–≤–∞–∂–¥—ã (Collections + Charts)
2. **Clean Architecture 4-—Å–ª–æ—è** - overkill –¥–ª—è 1120 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
3. **–î–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞** - –Ω–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ C# + Python
4. **–î–≤–∞ WebSocket —Å–µ—Ä–≤–µ—Ä–∞** - –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + overhead
5. **–ß–∞—Å–æ–≤–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - 35M –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

---

## –ß–ò–°–õ–ê

### –¢–µ–∫—É—â–µ–µ:
- **–ü–∞–º—è—Ç—å:** 708 MB (worst case)
- **–ö–æ–¥:** 1120 —Å—Ç—Ä–æ–∫
- **–ü—Ä–æ—Ü–µ—Å—Å–æ–≤:** 2
- **OOM —Ä–∏—Å–∫:** 100%

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **–ü–∞–º—è—Ç—å:** 150 MB (-79%) ‚¨áÔ∏è
- **–ö–æ–¥:** 600-700 —Å—Ç—Ä–æ–∫ (-40%) ‚¨áÔ∏è
- **–ü—Ä–æ—Ü–µ—Å—Å–æ–≤:** 1 (-50%) ‚¨áÔ∏è
- **OOM —Ä–∏—Å–∫:** 0% ‚úÖ

---

## –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### üî¥ –ù–ï–î–ï–õ–Ø 1 - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–£—Å–∏–ª–∏–µ:** 2 –¥–Ω—è
**–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ OOM

1. Bounded channels (2 —á–∞—Å–∞)
2. RollingWindow 5 –º–∏–Ω—É—Ç (30 –º–∏–Ω—É—Ç)
3. Event handlers cleanup (4 —á–∞—Å–∞)
4. StopAsync —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (4 —á–∞—Å–∞)

### üü† –ù–ï–î–ï–õ–Ø 2 - –†–ï–§–ê–ö–¢–û–†–ò–ù–ì

**–£—Å–∏–ª–∏–µ:** 1 –Ω–µ–¥–µ–ª—è
**–≠—Ñ—Ñ–µ–∫—Ç:** -79% –ø–∞–º—è—Ç–∏, -40% –∫–æ–¥–∞

5. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å Collections + Charts (3 –¥–Ω—è)
6. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É 4‚Üí2 —Å–ª–æ—è (2 –¥–Ω—è)

### üü° –ë–£–î–£–©–ï–ï - –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

7. TimescaleDB –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
8. Monitoring/alerting
9. Horizontal scaling

---

## –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

**C# (Collections):**
- ‚úÖ Domain layer (80 LOC)
- ‚úÖ Application layer (300 LOC)
- ‚úÖ Infrastructure layer (800+ LOC)
- ‚úÖ Presentation layer (250 LOC)
- ‚úÖ 8 Exchange clients
- ‚úÖ Channels, Hosted Services, WebSocket server

**Python (Charts):**
- ‚úÖ FastAPI server (200+ LOC)
- ‚úÖ RollingWindow (88 LOC)
- ‚úÖ Polars data processing
- ‚úÖ WebSocket client + server
- ‚úÖ Parquet I/O

### –ú–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞:

1. **Static code analysis** - –ø–æ–∏—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
2. **Memory profiling** - —Ä–∞—Å—á–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
3. **Architecture review** - –æ—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
4. **Event tracking** - —É—Ç–µ—á–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫
5. **Threading analysis** - race conditions
6. **Serialization audit** - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## –§–ê–ô–õ–´ –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

**C# (Collections):**
1. `src/SpreadAggregator.Presentation/Program.cs`
2. `src/SpreadAggregator.Application/Services/OrchestrationService.cs`
3. `src/SpreadAggregator.Application/Services/RollingWindowService.cs`
4. `src/SpreadAggregator.Infrastructure/Services/ParquetDataWriter.cs`
5. `src/SpreadAggregator.Infrastructure/Services/FleckWebSocketServer.cs`
6. `src/SpreadAggregator.Infrastructure/Services/Exchanges/Base/ExchangeClientBase.cs`

**Python (Charts):**
7. `charts/server.py`

---

## ROI

**–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:** 2 –Ω–µ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç—ã

**–í–æ–∑–≤—Ä–∞—Ç:**
- –ü–∞–º—è—Ç—å: -79%
- –ö–æ–¥: -40%
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: -50%
- OOM —Ä–∏—Å–∫: -100%
- Latency: -25%

**–í–µ—Ä–¥–∏–∫—Ç:** –û–ß–ï–ù–¨ –í–´–°–û–ö–ò–ô ROI

---

## –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –û–¢–ß–ï–¢–´

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –ö–†–ê–¢–ö–£–Æ_–°–í–û–î–ö–£.md
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OOM_–∞–Ω–∞–ª–∏–∑.md –∫–∞–∫ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
4. –°–ª–µ–¥—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –∏–∑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md

### –î–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–≤:

1. –ß–∏—Ç–∞–π—Ç–µ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π_–∞—É–¥–∏—Ç.md –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. –û—Ü–µ–Ω–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã
3. –ü—Ä–∏–º–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:

1. –ö–†–ê–¢–ö–ê–Ø_–°–í–û–î–ö–ê.md ‚Üí ROI –∞–Ω–∞–ª–∏–∑
2. –û—Ü–µ–Ω–∏—Ç–µ effort vs impact
3. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. Allocate —Ä–µ—Å—É—Ä—Å—ã (2 –Ω–µ–¥–µ–ª–∏)

---

## –í–û–ü–†–û–°–´ –ò –û–¢–í–ï–¢–´

**Q: –ù–∞—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã?**
A: 10 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ OOM. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω—É–∂–Ω–æ ASAP.

**Q: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?**
A: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ - 2 –¥–Ω—è. –ü–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ - 2 –Ω–µ–¥–µ–ª–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ?**
A: –î–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –Ω–µ–¥–µ–ª–∏ 1 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ). –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å.

**Q: –ù—É–∂–Ω—ã –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã?**
A: –ù–µ—Ç, –≤—Å–µ –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Å—Ç–µ–∫–µ.

**Q: –ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç?**
A: Memory profiling (dotMemory, py-spy) –¥–æ/–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

---

## –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ü—Ä–æ—á–∏—Ç–∞—Ç—å –ö–†–ê–¢–ö–£–Æ_–°–í–û–î–ö–£.md
2. ‚¨ú –û–±—Å—É–¥–∏—Ç—å —Å –∫–æ–º–∞–Ω–¥–æ–π
3. ‚¨ú –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
4. ‚¨ú –ù–∞—á–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–µ–¥–µ–ª—è 1)
5. ‚¨ú –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–Ω–µ–¥–µ–ª—è 2)
6. ‚¨ú –ò–∑–º–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–°–¢–ê–¢–£–°: –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**
