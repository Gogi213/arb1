# –ê–£–î–ò–¢ –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ô –†–ê–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò - ARB1

**–î–∞—Ç–∞:** 2025-11-08
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –†–ï–§–ê–ö–¢–û–†–ò–ù–ì

---

## EXECUTIVE SUMMARY

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ **charts** –∏ **collections** –∏–º–µ–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

1. ‚ùå **–ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - RollingWindow –∏ Parquet I/O —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–≤–∞–∂–¥—ã
2. ‚ùå **–ù–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** - Clean Architecture –∏–∑ 4 —Å–ª–æ–µ–≤ –¥–ª—è 1120 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
3. ‚ùå **–ù–µ—Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** - 2 –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–º–µ—Å—Ç–æ 1, –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
4. ‚ùå **Overkill —Ä–µ—à–µ–Ω–∏—è** - Unbounded channels, 1 —á–∞—Å –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
5. ‚úÖ **–•–æ—Ä–æ—à–∏–µ —á–∞—Å—Ç–∏** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Polars, Parquet, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫

---

## 1. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò

### 1.1 RollingWindow - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –î–í–ê–ñ–î–´

#### Collections (C#)
**–§–∞–π–ª:** `collections/src/SpreadAggregator.Application/Services/RollingWindowService.cs`
**–†–∞–∑–º–µ—Ä:** 86 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

```csharp
public class RollingWindowService
{
    private readonly ConcurrentDictionary<string, RollingWindowData> _windows;
    private readonly TimeSpan _windowSize = TimeSpan.FromHours(1);

    public async Task StartAsync(CancellationToken cancellationToken)
    {
        await foreach (var data in _channelReader.ReadAllAsync(cancellationToken))
        {
            ProcessData(data);
        }
    }
}
```

#### Charts (Python)
**–§–∞–π–ª:** `charts/server.py`
**–†–∞–∑–º–µ—Ä:** 88 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

```python
class RollingWindow:
    def __init__(self):
        self.windows: Dict[str, RollingWindowData] = {}
        self.window_size = timedelta(hours=1)

    def process_spread_data(self, data: dict):
        # –ò–¥–µ–Ω—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞!
```

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Collections | Charts | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ? |
|----------|------------|--------|---------------|
| –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ | 1 —á–∞—Å | 1 —á–∞—Å | ‚úÖ –î–ê |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö | ConcurrentDict | Dict | ‚úÖ –î–ê |
| Cleanup —Ç–∞–π–º–µ—Ä | 60 —Å–µ–∫ | 60 —Å–µ–∫ | ‚úÖ –î–ê |
| –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ | –ü–æ timestamp | –ü–æ timestamp | ‚úÖ –î–ê |
| –û–±—ä–µ–º –∫–æ–¥–∞ | 86 LOC | 88 LOC | ‚úÖ –î–ê |

**–í–µ—Ä–¥–∏–∫—Ç:** 100% –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
1. Collections —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ RollingWindow
2. –ü–µ—Ä–µ–¥–∞–µ—Ç —á–µ—Ä–µ–∑ WebSocket –≤ Charts
3. Charts –ü–û–í–¢–û–†–ù–û —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–≤–æ–π RollingWindow
4. –î–≤–æ–π–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏: 354 MB √ó 2 = 708 MB
5. –î–≤–µ –∫–æ–¥–æ–≤—ã–µ –±–∞–∑—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

### 1.2 Parquet I/O - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –î–í–ê–ñ–î–´

#### Collections - –ó–∞–ø–∏—Å—å
**–§–∞–π–ª:** `collections/src/SpreadAggregator.Infrastructure/Services/ParquetDataWriter.cs`
**–†–∞–∑–º–µ—Ä:** 271 —Å—Ç—Ä–æ–∫–∞

```csharp
public class ParquetDataWriter
{
    public async Task WriteSpreadsAsync(string filePath, IReadOnlyCollection<SpreadData> data)
    {
        var columns = CreateSpreadDataColumns(data);
        using var table = new Table(schema, columns);
        using var stream = File.Create(filePath);
        await ParquetWriter.WriteTableAsync(table, stream);
    }
}
```

#### Charts - –ß—Ç–µ–Ω–∏–µ
**–§–∞–π–ª:** `charts/server.py`, `charts/data_loader.py`
**–†–∞–∑–º–µ—Ä:** 120+ —Å—Ç—Ä–æ–∫

```python
def load_and_process_pair(opportunity: dict):
    files = glob.glob(f"{base_dir}/**/*.parquet", recursive=True)
    df = pl.read_parquet(files)
    # Processing...
```

#### –ü—Ä–æ–±–ª–µ–º—ã:

1. **–†–∞–∑–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
   - Collections: Parquet.Net (C#)
   - Charts: Polars (Python)
   - –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ö–µ–º

2. **–ù–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞:**
   - –°—Ö–µ–º–∞ —Å–ø—Ä–µ–¥–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –¥–≤–∞–∂–¥—ã
   - –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é

3. **–£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
   - –î–≤–∞ –Ω–∞–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤

**–í–µ—Ä–¥–∏–∫—Ç:** –ù–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### 1.3 WebSocket Server - –î–í–ê —Å–µ—Ä–≤–µ—Ä–∞

#### Collections WebSocket Server
**–§–∞–π–ª:** `collections/src/SpreadAggregator.Infrastructure/Services/FleckWebSocketServer.cs`
**–ü–æ—Ä—Ç:** 8181
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Charts

```csharp
var server = new WebSocketServer("ws://0.0.0.0:8181");
server.Start(socket => {
    socket.OnOpen = () => _allSockets.Add(socket);
});
```

#### Charts WebSocket Server
**–§–∞–π–ª:** `charts/server.py`
**–ü–æ—Ä—Ç:** 8002 (—á–µ—Ä–µ–∑ FastAPI)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞–º

```python
@app.websocket("/ws/realtime_charts")
async def websocket_endpoint(websocket: WebSocket):
    await websocket.accept()
    # Broadcast logic...
```

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Collections  ‚îÇ WebSocket        ‚îÇ  Charts  ‚îÇ  WebSocket     ‚îÇ  Client  ‚îÇ
‚îÇ   :8181      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ  :8002   ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ Browser  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò JSON serialize   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò JSON serialize ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                       ‚Üì
                                  RollingWindow
                                  (–¥—É–±–ª–∏–∫–∞—Ç!)
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–î–≤–æ–π–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
   - Collections ‚Üí JSON ‚Üí Charts
   - Charts ‚Üí JSON ‚Üí Client
   - Overhead 5-15ms –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

2. **–ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ:**
   - TCP/IP –≤–º–µ—Å—Ç–æ shared memory
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–æ–≤
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å deployment (2 –ø—Ä–æ—Ü–µ—Å—Å–∞)

3. **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏:**
   - WebSocket –º–æ–∂–µ—Ç –æ–±–æ—Ä–≤–∞—Ç—å—Å—è
   - –ù–µ—Ç retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**–í–µ—Ä–¥–∏–∫—Ç:** –ù–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

---

## 2. –ò–ó–ë–´–¢–û–ß–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### 2.1 Clean Architecture - 4 —Å–ª–æ—è –¥–ª—è 1120 LOC

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Collections:

```
SpreadAggregator.Domain/           (80 LOC)
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îî‚îÄ‚îÄ MarketData.cs              - SpreadData, TradeData, SymbolInfo
‚îÇ
SpreadAggregator.Application/      (300 LOC)
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ OrchestrationService.cs    - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ RollingWindowService.cs    - In-memory cache
‚îú‚îÄ‚îÄ Abstractions/
‚îÇ   ‚îî‚îÄ‚îÄ IExchangeClient.cs         - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ
SpreadAggregator.Infrastructure/   (800+ LOC)
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ Exchanges/                 - 8 –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–∏—Ä–∂
‚îÇ   ‚îú‚îÄ‚îÄ FleckWebSocketServer.cs
‚îÇ   ‚îî‚îÄ‚îÄ ParquetDataWriter.cs
‚îÇ
SpreadAggregator.Presentation/     (250 LOC)
‚îî‚îÄ‚îÄ Program.cs                     - DI, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

#### –ê–Ω–∞–ª–∏–∑:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û—Ü–µ–Ω–∫–∞ |
|---------|----------|--------|
| –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 1120 | –ù–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤ | 4 | –ú–Ω–æ–≥–æ |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ | 8 | –ú–Ω–æ–≥–æ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ |
| Hosted Services | 3 | –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å |
| –ö–∞–Ω–∞–ª–æ–≤ | 2 | –î–ª—è –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö |
| –ü—Ä–æ–µ–∫—Ç–æ–≤ –≤ solution | 4 | Overkill |

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–Ω–∞–ª–æ–≥–∞–º–∏:

**–¢–∏–ø–∏—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç 1000-2000 LOC:**
- 1-2 —Å–ª–æ—è
- 2-3 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- 1 –≥–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å

**Collections:**
- 4 —Å–ª–æ—è
- 8 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- 3 hosted —Å–µ—Ä–≤–∏—Å–∞
- –ö–∞–Ω–∞–ª—ã –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ–±—â–µ–Ω–∏—è

**–í–µ—Ä–¥–∏–∫—Ç:** Overengineering –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

### 2.2 –ó–∞—á–µ–º Channels –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞?

#### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
OrchestrationService
    ‚Üì
    ‚îú‚îÄ‚ñ∫ RawDataChannel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ DataCollectorService (Parquet Writer)
    ‚îÇ
    ‚îî‚îÄ‚ñ∫ RollingWindowChannel ‚îÄ‚îÄ‚ñ∫ RollingWindowService (In-Memory Cache)
```

#### –ü—Ä–æ–±–ª–µ–º—ã:

1. **Unbounded = —Ä–∏—Å–∫ OOM:**
   ```csharp
   Channel.CreateUnbounded<MarketData>()
   ```
   - –ü—Ä–∏ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–∏ consumer ‚Üí –∫–∞–Ω–∞–ª —Ä–∞—Å—Ç–µ—Ç
   - –ù–µ—Ç back-pressure

2. **–£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ:**
   - –ù—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å lifecycle
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å cancellation
   - –î–µ–±–∞–∂–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏

3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
   ```csharp
   // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤:
   await _dataCollector.WriteAsync(data);
   await _rollingWindow.AddAsync(data);

   // –ò–ª–∏ observer pattern:
   _dataCollector.OnNext(data);
   _rollingWindow.OnNext(data);
   ```

**–ö–æ–≥–¥–∞ channels –Ω—É–∂–Ω—ã:**
- –†–∞–∑–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –†–∞–∑–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ —Å —Ä–∞–∑–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é
- Buffering –∫—Ä–∏—Ç–∏—á–µ–Ω

**–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ:**
- –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å
- –û–¥–∏–Ω –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–∞

**–í–µ—Ä–¥–∏–∫—Ç:** –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ observer pattern

---

### 2.3 3 Hosted Services –¥–ª—è –æ–¥–Ω–æ–≥–æ pipeline

#### –¢–µ–∫—É—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

```csharp
services.AddHostedService<OrchestrationServiceHost>();
services.AddHostedService<DataCollectorService>();
services.AddHostedService<RollingWindowServiceHost>();
```

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π:

1. **OrchestrationServiceHost:**
   - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –±–∏—Ä–∂–∏
   - –ü–∏—à–µ—Ç –≤ –¥–≤–∞ –∫–∞–Ω–∞–ª–∞

2. **DataCollectorService:**
   - –ß–∏—Ç–∞–µ—Ç –∏–∑ RawDataChannel
   - –ü–∏—à–µ—Ç –≤ Parquet

3. **RollingWindowServiceHost:**
   - –ß–∏—Ç–∞–µ—Ç –∏–∑ RollingWindowChannel
   - –û–±–Ω–æ–≤–ª—è–µ—Ç in-memory cache

#### –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ—Ä—è–¥–∫–∞ –∑–∞–ø—É—Å–∫–∞:**
   - IHostedService –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å race condition

2. **–°–ª–æ–∂–Ω—ã–π shutdown:**
   - 3 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö StopAsync
   - –ù—É–∂–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è

3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å:**
   ```csharp
   // –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å:
   public class DataPipelineService : IHostedService
   {
       public async Task StartAsync(...)
       {
           await _orchestration.StartAsync(...);
           await Task.WhenAll(
               _dataCollector.StartAsync(...),
               _rollingWindow.StartAsync(...)
           );
       }
   }
   ```

**–í–µ—Ä–¥–∏–∫—Ç:** –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ 1 —Å–µ—Ä–≤–∏—Å–∞

---

## 3. –ù–ï–†–ê–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –†–ï–®–ï–ù–ò–Ø

### 3.1 –ó–∞—á–µ–º Python –¥–ª—è Charts?

#### –¢–µ–∫—É—â–∏–π —Å—Ç–µ–∫:
- **Collections:** C# / .NET 9
- **Charts:** Python / FastAPI

#### –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ó–ê Python:

‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
‚úÖ Polars –æ—Ç–ª–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è DataFrames
‚úÖ FastAPI –ø—Ä–æ—Å—Ç–æ–π –∏ –º–æ—â–Ω—ã–π
‚úÖ –ë–æ–≥–∞—Ç–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ data science

#### –ê—Ä–≥—É–º–µ–Ω—Ç—ã –ü–†–û–¢–ò–í Python:

‚ùå **–ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ:**
- WebSocket –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 5-20ms

‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- RollingWindow –≤ –æ–±–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –î–≤–∞ –Ω–∞–±–æ—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –î–≤–∞ deployment –ø—Ä–æ—Ü–µ—Å—Å–∞

‚ùå **GIL –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- Global Interpreter Lock
- –û–¥–∏–Ω CPU core –¥–ª—è Python –ª–æ–≥–∏–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º

‚ùå **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤:**
- C# ‚Üí JSON ‚Üí Python
- –ü–æ—Ç–µ—Ä—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- Runtime –æ—à–∏–±–∫–∏

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:

**Polars.NET** —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
```csharp
using Polars;

var df = DataFrame.ReadParquet("file.parquet");
var result = df.Select("column").Filter(...);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–¥–∏–Ω —è–∑—ã–∫
- Shared memory (–Ω–µ—Ç IPC)
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–í–µ—Ä–¥–∏–∫—Ç:** Python –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å C# + Polars.NET

---

### 3.2 1 —á–∞—Å –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ - –∑–∞—á–µ–º?

#### –¢–µ–∫—É—â–µ–µ:

```csharp
private readonly TimeSpan _windowSize = TimeSpan.FromHours(1);
```

#### –†–∞—Å—á–µ—Ç –ø–∞–º—è—Ç–∏:

```
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º:
- 800 —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä –∞–∫—Ç–∏–≤–Ω—ã
- 1 —Å–ø—Ä–µ–¥ –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ –ø–∞—Ä—É
- –†–∞–∑–º–µ—Ä SpreadData = 123 bytes

–ü–∞–º—è—Ç—å –∑–∞ 1 —á–∞—Å:
800 –ø–∞—Ä √ó 3600 —Å–µ–∫—É–Ω–¥ √ó 123 bytes = 354 MB

Trades (10x —á–∞—â–µ):
800 –ø–∞—Ä √ó 36000 —Å–µ–∫—É–Ω–¥ √ó 80 bytes = 2.3 GB

–ò–¢–û–ì–û: 2.65 GB
```

#### –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–æ 1 —á–∞—Å?

**–ü—Ä–æ–≤–µ—Ä–∏–ª –∫–æ–¥ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:**
- Rolling window calculations (percentiles)
- Real-time graphing

**–í–æ–ø—Ä–æ—Å:** –ù—É–∂–µ–Ω –ª–∏ –≤–µ—Å—å —á–∞—Å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤?

**–¢–∏–ø–∏—á–Ω—ã–µ UI —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ì—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5-15 –º–∏–Ω—É—Ç
- –†–µ–¥–∫–æ –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π —á–∞—Å –≤ real-time

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –£–º–µ–Ω—å—à–∏—Ç—å –¥–æ 5 –º–∏–Ω—É—Ç
```
2.65 GB √ó (5/60) = 220 MB (12x –º–µ–Ω—å—à–µ!)
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** Tier storage
- 5 –º–∏–Ω—É—Ç –≤ –ø–∞–º—è—Ç–∏ (full resolution)
- 1 —á–∞—Å –Ω–∞ –¥–∏—Å–∫–µ (aggregated)

**–í–µ—Ä–¥–∏–∫—Ç:** 1 —á–∞—Å - –∏–∑–±—ã—Ç–æ—á–Ω–æ, –Ω—É–∂–Ω–æ 5-15 –º–∏–Ω—É—Ç max

---

### 3.3 Unbounded Channels - —Ä–∏—Å–∫ OOM

#### –¢–µ–∫—É—â–µ–µ:

```csharp
services.AddSingleton<RawDataChannel>(
    new RawDataChannel(Channel.CreateUnbounded<MarketData>())
);
```

#### –ß—Ç–æ –∑–Ω–∞—á–∏—Ç Unbounded:

- ‚ùå –ù–µ—Ç –ª–∏–º–∏—Ç–∞ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ùå Producer –ù–ò–ö–û–ì–î–ê –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- ‚ùå –†–∞—Å—Ç–µ—Ç –¥–æ OOM –µ—Å–ª–∏ consumer –º–µ–¥–ª–µ–Ω–Ω–µ–µ

#### –ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```
Scenario: Disk I/O –º–µ–¥–ª–µ–Ω–Ω—ã–π (HDD, —Å–µ—Ç–µ–≤–æ–π –¥–∏—Å–∫)

Producer: 1000 msgs/sec
Consumer (Parquet Writer): 100 msgs/sec

–û—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç–µ—Ç: 900 msgs/sec
–ß–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç: 540,000 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏
–ü–∞–º—è—Ç—å: 540K √ó 500 bytes = 270 MB

–ß–µ—Ä–µ–∑ 1 —á–∞—Å: 3.24M —Å–æ–æ–±—â–µ–Ω–∏–π = 1.6 GB
–ß–µ—Ä–µ–∑ 10 —á–∞—Å–æ–≤: OOM
```

#### –†–µ—à–µ–Ω–∏–µ:

```csharp
var options = new BoundedChannelOptions(10000)
{
    FullMode = BoundedChannelFullMode.Wait // –ë–ª–æ–∫–∏—Ä—É–µ—Ç producer
};
```

**–ò–ª–∏ –ª—É—á—à–µ:**
```csharp
FullMode = BoundedChannelFullMode.DropOldest // –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ
```

**–í–µ—Ä–¥–∏–∫—Ç:** Unbounded - –æ–ø–∞—Å–Ω–æ, –Ω—É–∂–µ–Ω Bounded —Å drop policy

---

### 3.4 Parquet –≤–º–µ—Å—Ç–æ –°–£–ë–î

#### –¢–µ–∫—É—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: Parquet —Ñ–∞–π–ª—ã

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
‚úÖ –ü—Ä–æ—Å—Ç–æ–π deployment (–Ω–µ—Ç –°–£–ë–î)
‚úÖ –ö–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)
‚úÖ –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ –ü–æ—Ä—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤
‚ùå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (full scan)
‚ùå –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚ùå –ù–µ—Ç concurrent writes
‚ùå –ù–µ—Ç SQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:

**1. TimescaleDB (PostgreSQL extension)**
```sql
CREATE TABLE spreads (
    timestamp TIMESTAMPTZ NOT NULL,
    exchange TEXT,
    symbol TEXT,
    spread NUMERIC,
    PRIMARY KEY (timestamp, exchange, symbol)
);

SELECT create_hypertable('spreads', 'timestamp');
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ (avg, percentile)
- Retention policies (auto cleanup)
- SQL queries

**2. ClickHouse**
```sql
CREATE TABLE spreads (
    timestamp DateTime,
    exchange String,
    symbol String,
    spread Float64
) ENGINE = MergeTree()
ORDER BY (exchange, symbol, timestamp);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°—É–ø–µ—Ä –±—ã—Å—Ç—Ä—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**3. InfluxDB**
- Time-series —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
- Retention policies
- Downsampling (–∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

#### –ö–æ–≥–¥–∞ Parquet –æ–ø—Ä–∞–≤–¥–∞–Ω:

- ‚úÖ Write-once, read-many
- ‚úÖ Batch processing
- ‚úÖ Export –¥–ª—è ML
- ‚úÖ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –°–£–ë–î:

- ‚ùå Frequent queries
- ‚ùå Ad-hoc –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚ùå Real-time aggregations
- ‚ùå Multi-user access

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:**
- –ï—Å—Ç—å real-time –∑–∞–ø—Ä–æ—Å—ã
- –ù—É–∂–Ω—ã percentiles (–∞–≥—Ä–µ–≥–∞—Ü–∏–∏)
- Multi-user (dashboard)

**–í–µ—Ä–¥–∏–∫—Ç:** TimescaleDB –±—ã–ª–∞ –±—ã –ª—É—á—à–µ –¥–ª—è analytics, Parquet OK –¥–ª—è –∞—Ä—Ö–∏–≤–∞

---

### 3.5 –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —á–∞—Å–∞–º

#### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
market_data/
‚îú‚îÄ‚îÄ exchange=Binance/
‚îÇ   ‚îú‚îÄ‚îÄ symbol=BTCUSDT/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ date=2025-11-06/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hour=00/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ spreads_000.parquet
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trades_000.parquet
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hour=01/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
```

#### –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ú–Ω–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:**
   ```
   8 –±–∏—Ä–∂ √ó 500 —Å–∏–º–≤–æ–ª–æ–≤ √ó 365 –¥–Ω–µ–π √ó 24 —á–∞—Å–∞ = 35,040,000 –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π!
   ```

2. **File system overhead:**
   - –ú–µ–¥–ª–µ–Ω–Ω—ã–π `ls`
   - –°–ª–æ–∂–Ω—ã–π cleanup
   - –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ Windows (MAX_PATH)

3. **–ó–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤:**
   ```python
   # –î–ª—è 1 –¥–Ω—è –¥–∞–Ω–Ω—ã—Ö –ø–æ 1 –ø–∞—Ä–µ:
   files = glob.glob("**/hour=*/spreads_*.parquet")  # 24 —Ñ–∞–π–ª–∞
   ```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ –¥–Ω—è–º**
```
market_data/
‚îú‚îÄ‚îÄ Binance/
‚îÇ   ‚îî‚îÄ‚îÄ BTCUSDT/
‚îÇ       ‚îú‚îÄ‚îÄ 2025-11-06.parquet  # –í–µ—Å—å –¥–µ–Ω—å
‚îÇ       ‚îú‚îÄ‚îÄ 2025-11-07.parquet
‚îÇ       ‚îî‚îÄ‚îÄ ...
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- 8 √ó 500 √ó 365 = 1,460,000 —Ñ–∞–π–ª–æ–≤ (24x –º–µ–Ω—å—à–µ!)
- –ü—Ä–æ—â–µ –∑–∞–ø—Ä–æ—Å—ã
- –ú–µ–Ω—å—à–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ –º–µ—Å—è—Ü–∞–º + –ø–∞—Ä—Ç–∏—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ Parquet**
```
market_data/
‚îú‚îÄ‚îÄ Binance/
‚îÇ   ‚îî‚îÄ‚îÄ BTCUSDT/
‚îÇ       ‚îî‚îÄ‚îÄ 2025-11.parquet  # –ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ –¥–Ω—è–º –≤–Ω—É—Ç—Ä–∏
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï—â–µ –º–µ–Ω—å—à–µ —Ñ–∞–π–ª–æ–≤
- Parquet partitioning –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π

**–í–µ—Ä–¥–∏–∫—Ç:** –ß–∞—Å–æ–≤–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - overkill, –ª—É—á—à–µ –¥–Ω–µ–≤–Ω–æ–µ

---

## 4. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ú–ï–ñ–î–£ –ü–†–û–ï–ö–¢–ê–ú–ò

### 4.1 WebSocket –º–µ–∂–¥—É Collections ‚Üí Charts

#### –¢–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Collections     ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 1. –ü–æ–ª—É—á–∞–µ—Ç     ‚îÇ
‚îÇ    –æ—Ç –±–∏—Ä–∂      ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 2. RollingWindow‚îÇ
‚îÇ    (354 MB)     ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 3. Serialize    ‚îÇ
‚îÇ    to JSON      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ WebSocket (ws://localhost:8181)
         ‚îÇ {"MessageType": "Spread", "Payload": {...}}
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Charts         ‚îÇ
‚îÇ                ‚îÇ
‚îÇ 1. Deserialize ‚îÇ
‚îÇ    JSON        ‚îÇ
‚îÇ                ‚îÇ
‚îÇ 2. RollingWindow‚îÇ
‚îÇ    (354 MB)    ‚îÇ ‚Üê –î–£–ë–õ–ò–ö–ê–¢!
‚îÇ                ‚îÇ
‚îÇ 3. Serialize   ‚îÇ
‚îÇ    to JSON     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ WebSocket (ws://localhost:8002/ws/realtime_charts)
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Client Browser ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ê–Ω–∞–ª–∏–∑ overhead:

**Latency:**
- Collections ‚Üí JSON: 0.5-2 ms
- Network (localhost): 0.1-0.5 ms
- Charts ‚Üê JSON: 0.5-2 ms
- Charts ‚Üí JSON: 0.5-2 ms
- Network: 5-20 ms (internet)
- **Total:** 6.6-26.5 ms

**Memory:**
- Collections RollingWindow: 354 MB
- Charts RollingWindow: 354 MB
- **Total:** 708 MB (2x!)

**CPU:**
- JSON serialize: Collections
- JSON deserialize: Charts
- JSON serialize: Charts (again)

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –û–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Unified Service ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 1. –ü–æ–ª—É—á–∞–µ—Ç     ‚îÇ
‚îÇ    –æ—Ç –±–∏—Ä–∂      ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 2. RollingWindow‚îÇ
‚îÇ    (354 MB)     ‚îÇ ‚Üê –û–î–ò–ù —Ä–∞–∑
‚îÇ                 ‚îÇ
‚îÇ 3. Serialize    ‚îÇ
‚îÇ    to JSON      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ WebSocket
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Client Browser ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–∞–º—è—Ç—å: 708 MB ‚Üí 354 MB (-50%)
- Latency: 26.5 ms ‚Üí 20 ms (-25%)
- CPU: –º–µ–Ω—å—à–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–π
- –ü—Ä–æ—Å—Ç–æ—Ç–∞: 1 –ø—Ä–æ—Ü–µ—Å—Å –≤–º–µ—Å—Ç–æ 2

**–í–µ—Ä–¥–∏–∫—Ç:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 2 –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ

---

### 4.2 –ú–æ–∂–Ω–æ –ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å?

#### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Charts –Ω–∞ C#:**
   - FastAPI ‚Üí ASP.NET Core (–∞–Ω–∞–ª–æ–≥)
   - Polars (Python) ‚Üí Polars.NET
   - asyncio ‚Üí async/await (—É–∂–µ –µ—Å—Ç—å –≤ C#)

2. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å RollingWindow:**
   ```csharp
   // –û–¥–∏–Ω RollingWindowService –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
   // - Real-time updates
   // - WebSocket broadcasting
   // - Analytics queries
   ```

3. **–£–±—Ä–∞—Ç—å –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ:**
   - –ù–µ—Ç WebSocket –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
   - Shared memory
   - –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤

#### Effort –æ—Ü–µ–Ω–∫–∞:

| –ó–∞–¥–∞—á–∞ | –£—Å–∏–ª–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|--------|-----------|
| –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å HTTP API | 4 —á–∞—Å–∞ | –ù–∏–∑–∫–∞—è |
| –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å WebSocket | 2 —á–∞—Å–∞ | –ù–∏–∑–∫–∞—è |
| –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Polars –ª–æ–≥–∏–∫—É | 8 —á–∞—Å–æ–≤ | –°—Ä–µ–¥–Ω—è—è |
| –û–±—ä–µ–¥–∏–Ω–∏—Ç—å RollingWindow | 4 —á–∞—Å–∞ | –°—Ä–µ–¥–Ω—è—è |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 8 —á–∞—Å–æ–≤ | –°—Ä–µ–¥–Ω—è—è |
| **–ò–¢–û–ì–û** | **26 —á–∞—Å–æ–≤** | **~3-4 –¥–Ω—è** |

#### ROI:

**–î–æ:**
- LOC: 1120
- –ü–∞–º—è—Ç—å: 708 MB
- –ü—Ä–æ—Ü–µ—Å—Å–æ–≤: 2
- Latency: 26.5 ms

**–ü–æ—Å–ª–µ:**
- LOC: 600-700 (-40%)
- –ü–∞–º—è—Ç—å: 354 MB (-50%)
- –ü—Ä–æ—Ü–µ—Å—Å–æ–≤: 1 (-50%)
- Latency: 20 ms (-25%)

**–í–µ—Ä–¥–∏–∫—Ç:** –°—Ç–æ–∏—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å, ROI –≤—ã—Å–æ–∫–∏–π

---

## 5. –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –ü–û–î–•–û–î–´

### 5.1 Redis –¥–ª—è RollingWindow

#### –ö–æ–≥–¥–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª:

**Scenario: Distributed deployment**
```
Collections Instance 1 ‚îÄ‚îÄ‚îê
Collections Instance 2 ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚ñ∫ Redis (RollingWindow)
Collections Instance 3 ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Shared state –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
- Persistence (–Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ restart)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π eviction (TTL)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- Network latency (0.5-2 ms per operation)
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è overhead
- –ï—â–µ –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

#### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:

- ‚ùå –ù–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- ‚ùå –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ persistence
- ‚ùå Latency –≤–∞–∂–Ω–∞

**–í–µ—Ä–¥–∏–∫—Ç:** In-memory (ConcurrentDictionary) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ scale

---

### 5.2 Kafka –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### –ß—Ç–æ –¥–∞–µ—Ç Kafka:

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
- Replay events
- Partitioning
- Massive scale (millions/sec)
- Multiple consumers

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –°–ª–æ–∂–Ω—ã–π setup (Zookeeper/KRaft)
- –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
- Overhead –¥–ª—è –º–∞–ª—ã—Ö –æ–±—ä–µ–º–æ–≤

#### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:

**–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:**
- 8 –±–∏—Ä–∂ √ó 1000 updates/sec = 8000 msgs/sec
- –≠—Ç–æ **–ú–ê–õ–û** –¥–ª—è Kafka

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:**
- Real-time –≤–∞–∂–Ω–æ (Kafka –¥–æ–±–∞–≤–ª—è–µ—Ç latency)
- Replay –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω (–¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ)

**–í–µ—Ä–¥–∏–∫—Ç:** Kafka - OVERKILL –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∞

---

### 5.3 Apache Flink / Spark Streaming

#### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã:

- Netflix scale (millions of events/sec)
- –°–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ real-time
- Distributed processing
- Fault tolerance –∫—Ä–∏—Ç–∏—á–Ω–∞

#### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:

- 8K events/sec (–º–∞–ª—ã–π –º–∞—Å—à—Ç–∞–±)
- –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (percentiles)
- –û–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

**–í–µ—Ä–¥–∏–∫—Ç:** MASSIVE OVERKILL

---

### 5.4 ClickHouse –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è + –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Collections ‚îÄ‚îÄ‚ñ∫ ClickHouse ‚îÄ‚îÄ‚ñ∫ Charts API ‚îÄ‚îÄ‚ñ∫ Clients
                   ‚îÇ
                   ‚îî‚îÄ‚îÄ‚ñ∫ Analytics queries (–±—ã—Å—Ç—Ä—ã–µ!)
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

**1. –°—É–ø–µ—Ä –±—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
```sql
-- Percentiles –∑–∞ –ª—é–±–æ–π –ø–µ—Ä–∏–æ–¥ (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã):
SELECT
    toStartOfHour(timestamp) as hour,
    quantile(0.95)(spread) as p95
FROM spreads
WHERE timestamp >= now() - INTERVAL 1 DAY
GROUP BY hour
ORDER BY hour;
```

**2. –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```sql
ENGINE = MergeTree()
PARTITION BY toYYYYMMDD(timestamp)
ORDER BY (exchange, symbol, timestamp)
```

**3. Auto cleanup:**
```sql
ALTER TABLE spreads DROP PARTITION '20251101';
```

**4. Compression:**
- 10x-100x —Å–∂–∞—Ç–∏–µ
- –ú–µ–Ω—å—à–µ –¥–∏—Å–∫–∞

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

- –ï—â–µ –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- –ù—É–∂–µ–Ω deployment
- Learning curve

#### –ö–æ–≥–¥–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª:

- ‚úÖ –ù—É–∂–Ω—ã —Å–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ú–Ω–æ–≥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Multi-user dashboard

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç:**
- Charts API –¥–µ–ª–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É (percentiles)
- –í–æ–∑–º–æ–∂–µ–Ω growth –≤ –±—É–¥—É—â–µ–º

**–í–µ—Ä–¥–∏–∫—Ç:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–ª—è future iterations, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ —Å–µ–π—á–∞—Å

---

## 6. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–ü–†–û–©–ï–ù–ò–Æ

### 6.1 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°)

#### 1. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å Collections + Charts –≤ –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç

**Effort:** 3-4 –¥–Ω—è
**Impact:** -50% –ø–∞–º—è—Ç–∏, -40% –∫–æ–¥–∞, +25% –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü–ª–∞–Ω:**
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç `SpreadAggregator.Api`
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ HTTP API –∏–∑ Charts
3. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ WebSocket broadcasting
4. –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Polars –ª–æ–≥–∏–∫—É –Ω–∞ Polars.NET
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω RollingWindowService

---

#### 2. –£–º–µ–Ω—å—à–∏—Ç—å RollingWindow –¥–æ 5-15 –º–∏–Ω—É—Ç

**Effort:** 30 –º–∏–Ω—É—Ç
**Impact:** 354 MB ‚Üí 36 MB (12x —ç–∫–æ–Ω–æ–º–∏—è)

```csharp
private readonly TimeSpan _windowSize = TimeSpan.FromMinutes(5);
```

---

#### 3. Bounded Channels —Å drop policy

**Effort:** 2 —á–∞—Å–∞
**Impact:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ OOM

```csharp
var options = new BoundedChannelOptions(10000)
{
    FullMode = BoundedChannelFullMode.DropOldest
};
```

---

### 6.2 –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è)

#### 4. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: 4 —Å–ª–æ—è ‚Üí 2 —Å–ª–æ—è

**Effort:** 2 –¥–Ω—è
**Impact:** -200 LOC boilerplate

**–î–æ:**
```
Domain ‚Üí Application ‚Üí Infrastructure ‚Üí Presentation
```

**–ü–æ—Å–ª–µ:**
```
Core (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞) ‚Üí API (HTTP/WebSocket)
```

---

#### 5. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å 3 Hosted Services ‚Üí 1

**Effort:** 4 —á–∞—Å–∞
**Impact:** –£–ø—Ä–æ—â–µ–Ω–∏–µ lifecycle

```csharp
public class DataPipelineService : BackgroundService
{
    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        await _orchestration.StartAsync(stoppingToken);
        await Task.WhenAll(
            ProcessDataCollectionAsync(stoppingToken),
            ProcessRollingWindowAsync(stoppingToken)
        );
    }
}
```

---

#### 6. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: —á–∞—Å—ã ‚Üí –¥–Ω–∏

**Effort:** 1 –¥–µ–Ω—å
**Impact:** -95% –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
market_data/Binance/BTCUSDT/2025-11-06.parquet
```

---

### 6.3 –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

#### 7. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å TimescaleDB

**Effort:** 1 –Ω–µ–¥–µ–ª—è
**Impact:** –õ—É—á—à–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–ö–æ–≥–¥–∞:**
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–Ω–æ–≥–æ (TB+)
- –ï—Å–ª–∏ –Ω—É–∂–µ–Ω SQL

---

#### 8. –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**Effort:** 4 —á–∞—Å–∞
**Impact:** –ú–µ–Ω—å—à–µ boilerplate

**–ü—Ä–∏–º–µ—Ä—ã:**
- IExchangeClient - –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
- IRollingWindowService - –Ω–µ—Ç —Å–º—ã—Å–ª–∞, –æ–¥–∏–Ω implementation

---

## 7. –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ü—Ä–æ–µ–∫—Ç–æ–≤ | 2 (C# + Python) |
| –ü—Ä–æ—Ü–µ—Å—Å–æ–≤ | 2 |
| LOC | 1120 |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ–µ–≤ | 4 |
| RollingWindow —Ä–∞–∑–º–µ—Ä | 1 —á–∞—Å |
| –ü–∞–º—è—Ç—å (worst case) | 708 MB |
| –ö–∞–Ω–∞–ª–æ–≤ | 2 (unbounded) |
| Hosted Services | 3 |
| WebSocket —Å–µ—Ä–≤–µ—Ä–æ–≤ | 2 |
| Parquet I/O —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π | 2 |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—ã—Å–æ–∫–∞—è |

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------|-----------|
| –ü—Ä–æ–µ–∫—Ç–æ–≤ | 1 (C#) | -50% |
| –ü—Ä–æ—Ü–µ—Å—Å–æ–≤ | 1 | -50% |
| LOC | 600-700 | -40% |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ–µ–≤ | 2 | -50% |
| RollingWindow —Ä–∞–∑–º–µ—Ä | 5 –º–∏–Ω | -92% |
| –ü–∞–º—è—Ç—å (worst case) | 150 MB | -79% |
| –ö–∞–Ω–∞–ª–æ–≤ | 1-2 (bounded) | Same, safer |
| Hosted Services | 1 | -67% |
| WebSocket —Å–µ—Ä–≤–µ—Ä–æ–≤ | 1 | -50% |
| Parquet I/O —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π | 1 | -50% |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | -50% |

---

## 8. –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢

### ‚ùå –ù–ï–†–ê–¶–ò–û–ù–ê–õ–¨–ù–´–ï –†–ï–®–ï–ù–ò–Ø

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ RollingWindow** - 100% –∏–∑–±—ã—Ç–æ—á–Ω–æ
2. **Clean Architecture 4-—Å–ª–æ—è** - overkill –¥–ª—è 1120 LOC
3. **–î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞** - –Ω–µ–æ–ø—Ä–∞–≤–¥–∞–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
4. **1 —á–∞—Å –¥–∞–Ω–Ω—ã—Ö** - –∏–∑–±—ã—Ç–æ—á–Ω–æ, –Ω—É–∂–Ω–æ 5-15 –º–∏–Ω—É—Ç
5. **Unbounded channels** - —Ä–∏—Å–∫ OOM
6. **Python –¥–ª—è Charts** - –º–æ–∂–Ω–æ C# + Polars.NET
7. **–ß–∞—Å–æ–≤–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–ª–∏—à–∫–æ–º –º–µ–ª–∫–æ–µ
8. **3 Hosted Services** - –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å

### ‚úÖ –•–û–†–û–®–ò–ï –†–ï–®–ï–ù–ò–Ø

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Polars** - –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è DataFrames
2. **Parquet —Ñ–æ—Ä–º–∞—Ç** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
3. **Async/await –ø–∞—Ç—Ç–µ—Ä–Ω—ã** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
4. **WebSocket –¥–ª—è real-time** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è
5. **Clean separation of concerns** - —Ö–æ—Ä–æ—à–∞—è –∏–¥–µ—è (–Ω–æ overengineered)

### üéØ –ì–õ–ê–í–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

**–ù–µ–¥–µ–ª—è 1:**
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –≤ –æ–¥–∏–Ω (C#)
- RollingWindow ‚Üí 5 –º–∏–Ω—É—Ç
- Bounded channels

**–ù–µ–¥–µ–ª—è 2:**
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (2 —Å–ª–æ—è)
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å hosted services
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–Ω—è–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **LOC:** 1120 ‚Üí 600-700 (-40%)
- **–ü–∞–º—è—Ç—å:** 708 MB ‚Üí 150 MB (-79%)
- **–ü—Ä–æ—Ü–µ—Å—Å–æ–≤:** 2 ‚Üí 1 (-50%)
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è ‚Üí –°—Ä–µ–¥–Ω—è—è

---

**–ö–û–ù–ï–¶ –û–¢–ß–ï–¢–ê**
